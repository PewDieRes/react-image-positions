(this["webpackJsonpreact-image-positions"]=this["webpackJsonpreact-image-positions"]||[]).push([[0],[,,,,,function(e,t){},,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},,,,,,,,function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.r(t);var o=n(1),a=n.n(o),c=n(6),s=n.n(c),i=(n(11),n(12),n(2)),l=(n(13),n(0));var r=e=>{let{imageUrl:t,positions:n,onPositionsChange:a,coordinateOrigin:c,onCoordinateOriginChange:s}=e;const r=Object(o.useRef)(null),d=Object(o.useRef)(null),[h,j]=Object(o.useState)(1),[u,b]=Object(o.useState)(null),[x,p]=Object(o.useState)({x:0,y:0}),[m,O]=Object(o.useState)(!1),[g,y]=Object(o.useState)(null),[f,v]=Object(o.useState)(null),[N,w]=Object(o.useState)(null),[C,M]=Object(o.useState)("RECTANGLE"),[T,E]=Object(o.useState)(!1),[P,R]=Object(o.useState)(null),[F,I]=Object(o.useState)(null),k=Object(o.useRef)(null);Object(o.useEffect)(()=>{const e=d.current;if(e){const t=()=>{I({width:e.naturalWidth,height:e.naturalHeight})};if(!e.complete)return e.addEventListener("load",t),()=>e.removeEventListener("load",t);t()}},[t]);const S=Object(o.useCallback)((e,t)=>{if(!F)return{x:e,y:t};const{width:n,height:o}=F;switch(c){case"TOP_LEFT":default:return{x:e,y:t};case"TOP_RIGHT":return{x:n-e,y:t};case"BOTTOM_LEFT":return{x:e,y:o-t};case"BOTTOM_RIGHT":return{x:n-e,y:o-t};case"CENTER":return{x:e-n/2,y:t-o/2}}},[c,F]),D=Object(o.useCallback)((e,t)=>{if(!r.current||!d.current)return null;const n=d.current.getBoundingClientRect(),o=(e-n.left)/h,a=(t-n.top)/h;return console.log("Click at image coords: (".concat(Math.round(o),", ").concat(Math.round(a),") - Origin: TOP-LEFT")),{x:o,y:a}},[h]),L=Object(o.useCallback)(e=>{if(0!==e.button)return;const t=D(e.clientX,e.clientY);if(!t)return;const o=n.find(e=>t.x>=e.x&&t.x<=e.x+e.width&&t.y>=e.y&&t.y<=e.y+e.height);o?w(o.id):(O(!0),y(t),w(null))},[D,n]),A=Object(o.useCallback)(e=>{if(m&&g){const t=D(e.clientX,e.clientY);if(!t)return;const n=Math.min(g.x,t.x),o=Math.min(g.y,t.y),a=Math.abs(t.x-g.x),c=Math.abs(t.y-g.y);v({id:"temp",x:n,y:o,width:a,height:c,shape:C})}},[m,g,D,C]),B=Object(o.useCallback)(()=>{if(m&&f&&g){if(f.width>5&&f.height>5){const e={id:"pos-".concat(Date.now(),"-").concat(Math.random()),x:f.x,y:f.y,width:f.width,height:f.height,shape:C},t=f.x,o=f.y,s=f.width,i=f.height;if(console.log("=== NEW SHAPE CREATED ==="),console.log("Shape:",C),console.log("Coordinate Origin:",c),"RECTANGLE"===C){const e=[{x:t,y:o},{x:t+s,y:o},{x:t+s,y:o+i},{x:t,y:o+i}].map(e=>{const t=S(e.x,e.y);return{x:Math.round(t.x),y:Math.round(t.y)}});console.log("Top-left:",e[0]),console.log("Top-right:",e[1]),console.log("Bottom-right:",e[2]),console.log("Bottom-left:",e[3]),console.log("All 4 corners:",JSON.stringify(e))}else if("CIRCLE"===C){const e={x:t+s/2,y:o+i/2},n=S(e.x,e.y),a=Math.round(Math.max(s,i)/2);console.log("Center:",{x:Math.round(n.x),y:Math.round(n.y)}),console.log("Radius:",a)}else if("TRAPEZOID"===C){const e=.8*s,n=(s-e)/2,a=[{x:t+n,y:o},{x:t+n+e,y:o},{x:t+s,y:o+i},{x:t,y:o+i}].map(e=>{const t=S(e.x,e.y);return{x:Math.round(t.x),y:Math.round(t.y)}});console.log("Top-left:",a[0]),console.log("Top-right:",a[1]),console.log("Bottom-right:",a[2]),console.log("Bottom-left:",a[3]),console.log("All 4 corners:",JSON.stringify(a))}console.log("========================"),a([...n,e])}O(!1),y(null),v(null)}},[m,f,g,n,a,C,c,S]),G=Object(o.useCallback)(e=>{(1===e.button||0===e.button&&e.ctrlKey)&&(e.preventDefault(),b({x:e.clientX-x.x,y:e.clientY-x.y}))},[x]),U=Object(o.useCallback)(e=>{u&&p({x:e.clientX-u.x,y:e.clientY-u.y})},[u]),_=Object(o.useCallback)(()=>{b(null)},[]),J=Object(o.useCallback)(e=>{e.preventDefault();const t=e.deltaY>0?.9:1.1;j(e=>Math.max(.5,Math.min(5,e*t)))},[]);Object(o.useEffect)(()=>{const e=e=>{"Delete"!==e.key&&"Backspace"!==e.key||N&&(a(n.filter(e=>e.id!==N)),w(null)),"Escape"===e.key&&(E(!1),R(null))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[N,n,a]);const Z=n.find(e=>e.id===N),H=(e,t)=>{const o={left:"".concat(e.x*h,"px"),top:"".concat(e.y*h,"px"),width:"".concat(e.width*h,"px"),height:"".concat(e.height*h,"px"),transform:"translate(".concat(x.x,"px, ").concat(x.y,"px)")};let c={},s="position-shape",r="";if("CIRCLE"===e.shape)c=Object(i.a)(Object(i.a)({},o),{},{borderRadius:"50%"}),s="position-shape position-circle ".concat(t?"selected":"");else if("TRAPEZOID"===e.shape){const n=.8*e.width,a=(e.width-n)/2,l=a/e.width*100,d=(a+n)/e.width*100;r="polygon(".concat(l,"% 0%, ").concat(d,"% 0%, 100% 100%, 0% 100%)"),c=Object(i.a)(Object(i.a)({},o),{},{clipPath:r}),s="position-shape position-trapezoid ".concat(t?"selected":"")}else c=o,s="position-shape position-rectangle ".concat(t?"selected":"");T&&P!==e.id&&(s+=" selecting-target");const d=(e=>{const t=n.find(t=>t.showFileName&&t.fileNamePositionId===e&&t.overlayFileName);return(null===t||void 0===t?void 0:t.overlayFileName)||null})(e.id);return Object(l.jsxs)("div",{className:s,style:c,onClick:t=>{t.stopPropagation(),(e=>{if(T&&P){const t=n.map(t=>t.id===P?Object(i.a)(Object(i.a)({},t),{},{showFileName:!0,fileNamePositionId:e}):t);a(t),E(!1),R(null)}else w(e)})(e.id)},children:[e.overlayImage&&Object(l.jsx)("img",{src:e.overlayImage,alt:"Overlay",className:"overlay-image",style:{width:"100%",height:"100%",objectFit:"fill",borderRadius:"CIRCLE"===e.shape?"50%":"0",clipPath:"TRAPEZOID"===e.shape?r:void 0}}),d&&Object(l.jsx)("div",{className:"filename-display",children:d}),!e.overlayImage&&!d&&(()=>{const t=S(e.x,e.y),n=S(e.x+e.width,e.y+e.height);return Object(l.jsxs)("div",{className:"position-label",children:[Object(l.jsxs)("span",{children:["TL: (",Math.round(t.x),", ",Math.round(t.y),")"]}),Object(l.jsxs)("span",{children:["BR: (",Math.round(n.x),", ",Math.round(n.y),")"]})]})})(),e.overlayImage&&t&&Object(l.jsx)("div",{className:"overlay-indicator",children:"\ud83d\udcf7"}),e.showFileName&&e.fileNamePositionId&&Object(l.jsx)("div",{className:"link-indicator",children:"\ud83d\udd17"})]},e.id)};return Object(l.jsxs)("div",{className:"image-annotation-container",children:[Object(l.jsxs)("div",{className:"toolbar",children:[Object(l.jsxs)("div",{className:"zoom-controls",children:[Object(l.jsx)("button",{onClick:()=>j(e=>Math.max(.5,e-.1)),children:"Zoom Out"}),Object(l.jsxs)("span",{children:[Math.round(100*h),"%"]}),Object(l.jsx)("button",{onClick:()=>j(e=>Math.min(5,e+.1)),children:"Zoom In"}),Object(l.jsx)("button",{onClick:()=>j(1),children:"Reset Zoom"})]}),Object(l.jsx)("div",{className:"pan-controls",children:Object(l.jsx)("button",{onClick:()=>p({x:0,y:0}),children:"Reset Pan"})}),Object(l.jsxs)("div",{className:"shape-selector",children:[Object(l.jsx)("label",{children:"Shape: "}),Object(l.jsxs)("select",{value:C,onChange:e=>M(e.target.value),children:[Object(l.jsx)("option",{value:"RECTANGLE",children:"Rectangle"}),Object(l.jsx)("option",{value:"CIRCLE",children:"Circle"}),Object(l.jsx)("option",{value:"TRAPEZOID",children:"Trapezoid"})]})]}),Object(l.jsxs)("div",{className:"origin-selector",children:[Object(l.jsx)("label",{children:"Coordinate Origin: "}),Object(l.jsxs)("select",{value:c,onChange:e=>s(e.target.value),children:[Object(l.jsx)("option",{value:"TOP_LEFT",children:"Top-Left \u2198"}),Object(l.jsx)("option",{value:"TOP_RIGHT",children:"Top-Right \u2199"}),Object(l.jsx)("option",{value:"BOTTOM_LEFT",children:"Bottom-Left \u2197"}),Object(l.jsx)("option",{value:"BOTTOM_RIGHT",children:"Bottom-Right \u2196"}),Object(l.jsx)("option",{value:"CENTER",children:"Center \u271b"})]})]}),Object(l.jsx)("div",{className:"instructions",children:Object(l.jsx)("p",{children:"Click and drag to create shapes | Ctrl+Click to pan | Scroll to zoom | Delete to remove selected"})})]}),Object(l.jsxs)("div",{ref:r,className:"image-container",onMouseDown:L,onMouseMove:A,onMouseUp:B,onMouseLeave:B,onWheel:J,onMouseDownCapture:G,onMouseMoveCapture:U,onMouseUpCapture:_,children:[Object(l.jsx)("img",{ref:d,src:t,alt:"Annotation target",className:"annotation-image",style:{transform:"scale(".concat(h,") translate(").concat(x.x/h,"px, ").concat(x.y/h,"px)"),transformOrigin:"top left"},draggable:!1}),n.map(e=>H(e,e.id===N)),m&&f&&(()=>{const e={left:"".concat(f.x*h,"px"),top:"".concat(f.y*h,"px"),width:"".concat(f.width*h,"px"),height:"".concat(f.height*h,"px"),transform:"translate(".concat(x.x,"px, ").concat(x.y,"px)")};if("CIRCLE"===f.shape)return Object(l.jsx)("div",{className:"position-shape position-circle drawing",style:Object(i.a)(Object(i.a)({},e),{},{borderRadius:"50%"})});if("TRAPEZOID"===f.shape){const t=.8*f.width,n=(f.width-t)/2,o=n/f.width*100,a=(n+t)/f.width*100;return Object(l.jsx)("div",{className:"position-shape position-trapezoid drawing",style:Object(i.a)(Object(i.a)({},e),{},{clipPath:"polygon(".concat(o,"% 0%, ").concat(a,"% 0%, 100% 100%, 0% 100%)")})})}return Object(l.jsx)("div",{className:"position-shape position-rectangle drawing",style:e})})()]}),T&&Object(l.jsx)("div",{className:"selection-mode-banner",children:"\ud83c\udfaf Click on a position where the filename should be displayed (ESC to cancel)"}),Z&&Object(l.jsxs)("div",{className:"selected-position-controls",children:[Object(l.jsx)("h4",{children:"Selected Position Controls"}),Object(l.jsxs)("div",{className:"control-group",children:[Object(l.jsx)("label",{children:"Overlay Image:"}),Object(l.jsx)("input",{ref:k,type:"file",accept:"image/*",onChange:e=>{var t;const o=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!o||!N)return;const c=new FileReader;c.onloadend=()=>{const e=n.map(e=>e.id===N?Object(i.a)(Object(i.a)({},e),{},{overlayImage:c.result,overlayFileName:o.name}):e);a(e)},c.readAsDataURL(o),k.current&&(k.current.value="")},style:{display:"none"},id:"overlay-upload"}),Object(l.jsxs)("div",{className:"control-buttons",children:[Object(l.jsx)("label",{htmlFor:"overlay-upload",className:"control-btn upload-overlay-btn",children:Z.overlayImage?"Change Image":"Upload Image"}),Z.overlayImage&&Object(l.jsx)("button",{className:"control-btn remove-overlay-btn",onClick:()=>{if(!N)return;const e=n.map(e=>e.id===N?Object(i.a)(Object(i.a)({},e),{},{overlayImage:null,overlayFileName:null}):e);a(e)},children:"Remove Image"})]}),Z.overlayFileName&&Object(l.jsxs)("span",{className:"filename-info",children:["\ud83d\udcce ",Z.overlayFileName]})]}),Object(l.jsxs)("div",{className:"control-group",children:[Object(l.jsx)("label",{children:"Show Filename in Another Position:"}),Object(l.jsxs)("div",{className:"control-buttons",children:[Object(l.jsx)("button",{className:"control-btn ".concat(Z.showFileName?"active":""),onClick:()=>{if(!N)return;const e=n.find(e=>e.id===N);if(e)if(e.showFileName){const e=n.map(e=>e.id===N?Object(i.a)(Object(i.a)({},e),{},{showFileName:!1,fileNamePositionId:null}):e);a(e)}else E(!0),R(N)},disabled:!Z.overlayImage,children:Z.showFileName?"Linked to Position":"Link Filename Display"}),Z.showFileName&&Object(l.jsx)("button",{className:"control-btn remove-link-btn",onClick:()=>{const e=n.map(e=>e.id===N?Object(i.a)(Object(i.a)({},e),{},{showFileName:!1,fileNamePositionId:null}):e);a(e)},children:"Remove Link"})]}),!Z.overlayImage&&Object(l.jsx)("span",{className:"hint-text",children:"Upload an image first to enable filename display"})]})]}),Object(l.jsxs)("div",{className:"positions-list",children:[Object(l.jsxs)("h3",{children:["Positions (",n.length,")"]}),0===n.length?Object(l.jsx)("p",{className:"empty-list",children:"No positions selected yet"}):Object(l.jsx)("div",{className:"positions-table",children:Object(l.jsxs)("table",{children:[Object(l.jsx)("thead",{children:Object(l.jsxs)("tr",{children:[Object(l.jsx)("th",{children:"#"}),Object(l.jsx)("th",{children:"Shape"}),Object(l.jsx)("th",{children:"Coordinates"}),Object(l.jsx)("th",{children:"Action"})]})}),Object(l.jsx)("tbody",{children:n.map((e,t)=>{let o=[];if("RECTANGLE"===e.shape){const t=S(e.x,e.y),n=S(e.x+e.width,e.y+e.height);o=[{x:Math.round(t.x),y:Math.round(t.y),label:"Top-left"},{x:Math.round(n.x),y:Math.round(n.y),label:"Bottom-right"}]}else if("CIRCLE"===e.shape){const t=e.x+e.width/2,n=e.y+e.height/2,a=S(t,n),c=Math.round(Math.max(e.width,e.height)/2);o=[{x:Math.round(a.x),y:Math.round(a.y),label:"Center"},{x:c,y:0,label:"Radius"}]}else if("TRAPEZOID"===e.shape){const t=.8*e.width,n=(e.width-t)/2,a=S(e.x+n,e.y),c=S(e.x+e.width,e.y+e.height);o=[{x:Math.round(a.x),y:Math.round(a.y),label:"Top-left"},{x:Math.round(c.x),y:Math.round(c.y),label:"Bottom-right"}]}return Object(l.jsxs)("tr",{className:N===e.id?"selected-row":"",onClick:()=>w(e.id),children:[Object(l.jsx)("td",{children:t+1}),Object(l.jsx)("td",{children:e.shape}),Object(l.jsx)("td",{className:"coordinates-cell",children:o.map((e,t)=>Object(l.jsxs)("span",{className:"coordinate-point",children:[e.label,": (",e.x,", ",e.y,")"]},t))}),Object(l.jsx)("td",{children:Object(l.jsx)("button",{onClick:t=>{t.stopPropagation(),a(n.filter(t=>t.id!==e.id))},className:"delete-btn",children:"Delete"})})]},e.id)})})]})})]})]})},d=n(3);d.GlobalWorkerOptions.workerSrc="//cdnjs.cloudflare.com/ajax/libs/pdf.js/".concat(d.version,"/pdf.worker.min.js");var h=function(){const[e,t]=Object(o.useState)(null),[n,a]=Object(o.useState)([]),[c,s]=Object(o.useState)(null),[i,h]=Object(o.useState)(!1),[j,u]=Object(o.useState)(null),[b,x]=Object(o.useState)(!1),[p,m]=Object(o.useState)("TOP_LEFT"),O=Object(o.useRef)(null),g=async e=>{if(j){x(!0),h(!1);try{const n=await(async(e,t)=>{const n=await e.arrayBuffer(),o=new Uint8Array(n),a=await d.getDocument({data:o}).promise,c=await a.getPage(1),i=c.getViewport({scale:1}),l=c.getViewport({scale:2}),r=document.createElement("canvas");r.width=l.width,r.height=l.height;const h=r.getContext("2d");if(!h)throw new Error("Could not get canvas context");await c.render({canvasContext:h,viewport:l}).promise;const j="PNG"===t?"image/png":"image/jpeg",u="JPEG"===t?.95:void 0,b=r.toDataURL(j,u);return s({width:i.width,height:i.height}),console.log("PDF converted to ".concat(t)),console.log("Original PDF dimensions: ".concat(i.width," x ").concat(i.height)),console.log("Canvas dimensions: ".concat(r.width," x ").concat(r.height)),b})(j,e);t(n),a([])}catch(n){console.error("Error converting PDF:",n),alert("Failed to convert PDF. Please try again.")}finally{x(!1),u(null)}}},y=(e,t)=>{if(!c)return{x:e,y:t};const{width:n,height:o}=c;switch(p){case"TOP_LEFT":default:return{x:e,y:t};case"TOP_RIGHT":return{x:n-e,y:t};case"BOTTOM_LEFT":return{x:e,y:o-t};case"BOTTOM_RIGHT":return{x:n-e,y:o-t};case"CENTER":return{x:e-n/2,y:t-o/2}}};return Object(l.jsxs)("div",{className:"app",children:[Object(l.jsxs)("div",{className:"app-header",children:[Object(l.jsx)("h1",{children:"Advertisement Position Selector"}),Object(l.jsx)("div",{className:"app-controls",children:e?Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)("button",{onClick:()=>{t(null),a([]),s(null),u(null),h(!1),O.current&&(O.current.value="")},className:"reset-button",children:"Upload New Image"}),Object(l.jsxs)("button",{onClick:()=>{if(0===n.length)return void alert("No positions to save");const e=n.map(e=>{let t=[];if("RECTANGLE"===e.shape){const n=y(e.x,e.y),o=y(e.x+e.width,e.y+e.height);t=[{x:Math.round(n.x),y:Math.round(n.y)},{x:Math.round(o.x),y:Math.round(o.y)}]}else if("CIRCLE"===e.shape){const n=e.x+e.width/2,o=e.y+e.height/2,a=y(n,o),c=Math.round(Math.max(e.width,e.height)/2);t=[{x:Math.round(a.x),y:Math.round(a.y)},{x:c,y:0}]}else if("TRAPEZOID"===e.shape){const n=.8*e.width,o=(e.width-n)/2,a=y(e.x+o,e.y),c=y(e.x+e.width,e.y+e.height);t=[{x:Math.round(a.x),y:Math.round(a.y)},{x:Math.round(c.x),y:Math.round(c.y)}]}return{coordinates:JSON.stringify(t),shape:e.shape}}),t=JSON.stringify(e,null,2);console.log("=== SAVE POSITIONS ==="),console.log("Coordinate Origin:",p),console.log("Image Dimensions:",c),console.log("Database Format (Coordinates | Shape):"),e.forEach((e,t)=>{console.log("".concat(t+1,". Coordinates: ").concat(e.coordinates," | Shape: ").concat(e.shape))}),console.log("\nFull JSON:",t),console.log("======================");const o="Database Format:\n\n".concat(e.map((e,t)=>"Position ".concat(t+1,":\n  Coordinates: ").concat(e.coordinates,"\n  Shape: ").concat(e.shape)).join("\n\n"),"\n\n\n(Also check console for full details)");alert(o)},className:"save-button",disabled:0===n.length,children:["Save Positions (",n.length,")"]})]}):Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)("input",{ref:O,type:"file",accept:"image/*,.pdf",onChange:e=>{var n;const o=null===(n=e.target.files)||void 0===n?void 0:n[0];if(!o)return;if("application/pdf"===o.type)return u(o),void h(!0);const c=new FileReader;c.onloadend=()=>{const e=c.result,n=new Image;n.onload=()=>{s({width:n.naturalWidth,height:n.naturalHeight}),t(e),a([])},n.src=e},c.readAsDataURL(o)},style:{display:"none"},id:"image-upload",disabled:b}),Object(l.jsx)("label",{htmlFor:"image-upload",className:"upload-button ".concat(b?"disabled":""),children:b?"Converting PDF...":"Upload Image/PDF"})]})})]}),e?Object(l.jsx)(r,{imageUrl:e,positions:n,onPositionsChange:e=>{a(e)},coordinateOrigin:p,onCoordinateOriginChange:m}):Object(l.jsxs)("div",{className:"empty-state",children:[Object(l.jsx)("p",{children:"Upload an image or PDF to start selecting advertisement positions"}),b&&Object(l.jsx)("p",{className:"converting-text",children:"Converting PDF, please wait..."})]}),i&&Object(l.jsx)("div",{className:"modal-overlay",children:Object(l.jsxs)("div",{className:"modal",children:[Object(l.jsx)("h2",{children:"Select Output Format"}),Object(l.jsx)("p",{children:"Choose the image format for the PDF conversion:"}),Object(l.jsx)("p",{className:"modal-note",children:"Dimensions will be preserved for accurate position mapping."}),Object(l.jsxs)("div",{className:"modal-buttons",children:[Object(l.jsxs)("button",{className:"format-button png-button",onClick:()=>g("PNG"),children:["PNG",Object(l.jsx)("span",{className:"format-desc",children:"Lossless, larger file"})]}),Object(l.jsxs)("button",{className:"format-button jpeg-button",onClick:()=>g("JPEG"),children:["JPEG",Object(l.jsx)("span",{className:"format-desc",children:"Compressed, smaller file"})]})]}),Object(l.jsx)("button",{className:"cancel-button",onClick:()=>{h(!1),u(null),O.current&&(O.current.value="")},children:"Cancel"})]})}),c&&Object(l.jsxs)("div",{className:"dimensions-info",children:["Original PDF Size: ",Math.round(c.width)," x ",Math.round(c.height)," px"]})]})};s.a.render(Object(l.jsx)(a.a.StrictMode,{children:Object(l.jsx)(h,{})}),document.getElementById("root"))}],[[26,1,2]]]);
//# sourceMappingURL=main.0f7f111c.chunk.js.map