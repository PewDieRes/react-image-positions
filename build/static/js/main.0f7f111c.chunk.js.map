{"version":3,"sources":["components/ImageAnnotation.tsx","App.tsx","index.tsx"],"names":["ImageAnnotation","_ref","imageUrl","positions","onPositionsChange","coordinateOrigin","onCoordinateOriginChange","containerRef","useRef","imageRef","scale","setScale","useState","panStart","setPanStart","panOffset","setPanOffset","x","y","isDrawing","setIsDrawing","drawStart","setDrawStart","currentRect","setCurrentRect","selectedPosition","setSelectedPosition","selectedShape","setSelectedShape","isSelectingFileNamePosition","setIsSelectingFileNamePosition","pendingFileNameLinkId","setPendingFileNameLinkId","imageDimensions","setImageDimensions","overlayInputRef","useEffect","img","current","handleLoad","width","naturalWidth","height","naturalHeight","complete","addEventListener","removeEventListener","transformCoordinate","useCallback","imgW","imgH","getImageCoordinates","clientX","clientY","imageRect","getBoundingClientRect","imageX","left","imageY","top","console","log","concat","Math","round","handleMouseDown","e","button","coords","clickedPosition","find","pos","id","handleMouseMove","min","abs","shape","handleMouseUp","newPosition","Date","now","random","w","h","transformedCorners","map","c","t","JSON","stringify","rawCenter","center","radius","max","topWidth","topOffset","handlePanStart","ctrlKey","preventDefault","handlePanMove","handlePanEnd","handleWheel","delta","deltaY","prev","handleKeyDown","key","filter","p","window","selectedPositionObj","renderPosition","position","isSelected","baseStyle","transform","shapeStyle","shapeClass","clipPath","_objectSpread","borderRadius","topLeftPercent","topRightPercent","linkedFileName","positionId","linkingPosition","showFileName","fileNamePositionId","overlayFileName","getLinkedFileName","_jsxs","className","style","onClick","stopPropagation","updatedPositions","handlePositionClick","children","overlayImage","_jsx","src","alt","objectFit","undefined","tl","br","s","value","onChange","target","ref","onMouseDown","onMouseMove","onMouseUp","onMouseLeave","onWheel","onMouseDownCapture","onMouseMoveCapture","onMouseUpCapture","transformOrigin","draggable","type","accept","event","_event$target$files","file","files","reader","FileReader","onloadend","result","name","readAsDataURL","display","htmlFor","handleRemoveOverlay","handleToggleFileName","disabled","length","index","cornerPoints","label","rawCenterX","rawCenterY","pt","i","pdfjsLib","workerSrc","App","setImageUrl","setPositions","showFormatModal","setShowFormatModal","pendingPdfFile","setPendingPdfFile","isConverting","setIsConverting","setCoordinateOrigin","fileInputRef","handleFormatSelect","async","imageDataUrl","format","arrayBuffer","uint8Array","Uint8Array","pdf","data","promise","page","getPage","viewport","getViewport","scaledViewport","canvas","document","createElement","context","getContext","Error","render","canvasContext","mimeType","quality","dataUrl","toDataURL","convertPdfToImage","error","alert","_Fragment","handleReset","handleSavePositions","databaseFormat","coordinates","formattedData","forEach","item","alertMessage","join","Image","onload","newPositions","handleCancelFormatModal","ReactDOM","React","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.0f7f111c.chunk.js","sourcesContent":["import React, { useState, useRef, useCallback, useEffect } from \"react\";\nimport { Position, ShapeType, CoordinateOrigin } from \"../App\";\nimport \"./ImageAnnotation.css\";\n\ninterface ImageAnnotationProps {\n  imageUrl: string;\n  positions: Position[];\n  onPositionsChange: (positions: Position[]) => void;\n  coordinateOrigin: CoordinateOrigin;\n  onCoordinateOriginChange: (origin: CoordinateOrigin) => void;\n}\n\nconst ImageAnnotation: React.FC<ImageAnnotationProps> = ({\n  imageUrl,\n  positions,\n  onPositionsChange,\n  coordinateOrigin,\n  onCoordinateOriginChange,\n}) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const imageRef = useRef<HTMLImageElement>(null);\n  const [scale, setScale] = useState(1);\n  const [panStart, setPanStart] = useState<{ x: number; y: number } | null>(\n    null\n  );\n  const [panOffset, setPanOffset] = useState({ x: 0, y: 0 });\n  const [isDrawing, setIsDrawing] = useState(false);\n  const [drawStart, setDrawStart] = useState<{ x: number; y: number } | null>(\n    null\n  );\n  const [currentRect, setCurrentRect] = useState<Position | null>(null);\n  const [selectedPosition, setSelectedPosition] = useState<string | null>(null);\n  const [selectedShape, setSelectedShape] = useState<ShapeType>(\"RECTANGLE\");\n  const [isSelectingFileNamePosition, setIsSelectingFileNamePosition] =\n    useState(false);\n  const [pendingFileNameLinkId, setPendingFileNameLinkId] = useState<\n    string | null\n  >(null);\n  const [imageDimensions, setImageDimensions] = useState<{\n    width: number;\n    height: number;\n  } | null>(null);\n  const overlayInputRef = useRef<HTMLInputElement>(null);\n\n  // Get image dimensions when image loads\n  useEffect(() => {\n    const img = imageRef.current;\n    if (img) {\n      const handleLoad = () => {\n        setImageDimensions({\n          width: img.naturalWidth,\n          height: img.naturalHeight,\n        });\n      };\n      if (img.complete) {\n        handleLoad();\n      } else {\n        img.addEventListener(\"load\", handleLoad);\n        return () => img.removeEventListener(\"load\", handleLoad);\n      }\n    }\n  }, [imageUrl]);\n\n  // Transform coordinates based on selected origin\n  const transformCoordinate = useCallback(\n    (x: number, y: number): { x: number; y: number } => {\n      if (!imageDimensions) return { x, y };\n\n      const { width: imgW, height: imgH } = imageDimensions;\n\n      switch (coordinateOrigin) {\n        case \"TOP_LEFT\":\n          return { x, y }; // Default - no transformation\n        case \"TOP_RIGHT\":\n          return { x: imgW - x, y };\n        case \"BOTTOM_LEFT\":\n          return { x, y: imgH - y };\n        case \"BOTTOM_RIGHT\":\n          return { x: imgW - x, y: imgH - y };\n        case \"CENTER\":\n          return { x: x - imgW / 2, y: y - imgH / 2 };\n        default:\n          return { x, y };\n      }\n    },\n    [coordinateOrigin, imageDimensions]\n  );\n\n  // Get coordinates relative to the original image's TOP-LEFT corner\n  // In this coordinate system: (0,0) is at TOP-LEFT of image\n  // X increases to the RIGHT, Y increases DOWNWARD\n  const getImageCoordinates = useCallback(\n    (clientX: number, clientY: number): { x: number; y: number } | null => {\n      if (!containerRef.current || !imageRef.current) return null;\n\n      // Get the actual image element's bounding rect (accounts for transforms)\n      const imageRect = imageRef.current.getBoundingClientRect();\n\n      // Calculate position relative to the image's top-left corner\n      // This gives us coordinates where (0,0) is at the image's top-left\n      const imageX = (clientX - imageRect.left) / scale;\n      const imageY = (clientY - imageRect.top) / scale;\n\n      // Log for debugging\n      console.log(\n        `Click at image coords: (${Math.round(imageX)}, ${Math.round(\n          imageY\n        )}) - Origin: TOP-LEFT`\n      );\n\n      return { x: imageX, y: imageY };\n    },\n    [scale]\n  );\n\n  // Handle mouse down for drawing\n  const handleMouseDown = useCallback(\n    (e: React.MouseEvent) => {\n      if (e.button !== 0) return; // Only left mouse button\n\n      const coords = getImageCoordinates(e.clientX, e.clientY);\n      if (!coords) return;\n\n      // Check if clicking on an existing position\n      const clickedPosition = positions.find((pos) => {\n        return (\n          coords.x >= pos.x &&\n          coords.x <= pos.x + pos.width &&\n          coords.y >= pos.y &&\n          coords.y <= pos.y + pos.height\n        );\n      });\n\n      if (clickedPosition) {\n        setSelectedPosition(clickedPosition.id);\n        return;\n      }\n\n      // Start drawing new rectangle\n      setIsDrawing(true);\n      setDrawStart(coords);\n      setSelectedPosition(null);\n    },\n    [getImageCoordinates, positions]\n  );\n\n  // Handle mouse move for drawing\n  const handleMouseMove = useCallback(\n    (e: React.MouseEvent) => {\n      if (isDrawing && drawStart) {\n        const coords = getImageCoordinates(e.clientX, e.clientY);\n        if (!coords) return;\n\n        const x = Math.min(drawStart.x, coords.x);\n        const y = Math.min(drawStart.y, coords.y);\n        const width = Math.abs(coords.x - drawStart.x);\n        const height = Math.abs(coords.y - drawStart.y);\n\n        setCurrentRect({\n          id: \"temp\",\n          x,\n          y,\n          width,\n          height,\n          shape: selectedShape,\n        });\n      }\n    },\n    [isDrawing, drawStart, getImageCoordinates, selectedShape]\n  );\n\n  // Handle mouse up to finish drawing\n  const handleMouseUp = useCallback(() => {\n    if (isDrawing && currentRect && drawStart) {\n      // Only add if rectangle has meaningful size\n      if (currentRect.width > 5 && currentRect.height > 5) {\n        const newPosition: Position = {\n          id: `pos-${Date.now()}-${Math.random()}`,\n          x: currentRect.x,\n          y: currentRect.y,\n          width: currentRect.width,\n          height: currentRect.height,\n          shape: selectedShape,\n        };\n\n        // Log coordinates with transformation\n        const x = currentRect.x;\n        const y = currentRect.y;\n        const w = currentRect.width;\n        const h = currentRect.height;\n\n        console.log(\"=== NEW SHAPE CREATED ===\");\n        console.log(\"Shape:\", selectedShape);\n        console.log(\"Coordinate Origin:\", coordinateOrigin);\n\n        if (selectedShape === \"RECTANGLE\") {\n          // Raw corners (before transform)\n          const rawCorners = [\n            { x: x, y: y },\n            { x: x + w, y: y },\n            { x: x + w, y: y + h },\n            { x: x, y: y + h },\n          ];\n          // Transformed corners\n          const transformedCorners = rawCorners.map((c) => {\n            const t = transformCoordinate(c.x, c.y);\n            return { x: Math.round(t.x), y: Math.round(t.y) };\n          });\n          console.log(\"Top-left:\", transformedCorners[0]);\n          console.log(\"Top-right:\", transformedCorners[1]);\n          console.log(\"Bottom-right:\", transformedCorners[2]);\n          console.log(\"Bottom-left:\", transformedCorners[3]);\n          console.log(\"All 4 corners:\", JSON.stringify(transformedCorners));\n        } else if (selectedShape === \"CIRCLE\") {\n          const rawCenter = { x: x + w / 2, y: y + h / 2 };\n          const center = transformCoordinate(rawCenter.x, rawCenter.y);\n          const radius = Math.round(Math.max(w, h) / 2);\n          console.log(\"Center:\", {\n            x: Math.round(center.x),\n            y: Math.round(center.y),\n          });\n          console.log(\"Radius:\", radius);\n        } else if (selectedShape === \"TRAPEZOID\") {\n          const topWidth = w * 0.8;\n          const topOffset = (w - topWidth) / 2;\n          const rawCorners = [\n            { x: x + topOffset, y: y },\n            { x: x + topOffset + topWidth, y: y },\n            { x: x + w, y: y + h },\n            { x: x, y: y + h },\n          ];\n          const transformedCorners = rawCorners.map((c) => {\n            const t = transformCoordinate(c.x, c.y);\n            return { x: Math.round(t.x), y: Math.round(t.y) };\n          });\n          console.log(\"Top-left:\", transformedCorners[0]);\n          console.log(\"Top-right:\", transformedCorners[1]);\n          console.log(\"Bottom-right:\", transformedCorners[2]);\n          console.log(\"Bottom-left:\", transformedCorners[3]);\n          console.log(\"All 4 corners:\", JSON.stringify(transformedCorners));\n        }\n        console.log(\"========================\");\n\n        onPositionsChange([...positions, newPosition]);\n      }\n      setIsDrawing(false);\n      setDrawStart(null);\n      setCurrentRect(null);\n    }\n  }, [\n    isDrawing,\n    currentRect,\n    drawStart,\n    positions,\n    onPositionsChange,\n    selectedShape,\n    coordinateOrigin,\n    transformCoordinate,\n  ]);\n\n  // Handle panning\n  const handlePanStart = useCallback(\n    (e: React.MouseEvent) => {\n      if (e.button === 1 || (e.button === 0 && e.ctrlKey)) {\n        // Middle mouse button or Ctrl + Left click\n        e.preventDefault();\n        setPanStart({ x: e.clientX - panOffset.x, y: e.clientY - panOffset.y });\n      }\n    },\n    [panOffset]\n  );\n\n  const handlePanMove = useCallback(\n    (e: React.MouseEvent) => {\n      if (panStart) {\n        setPanOffset({\n          x: e.clientX - panStart.x,\n          y: e.clientY - panStart.y,\n        });\n      }\n    },\n    [panStart]\n  );\n\n  const handlePanEnd = useCallback(() => {\n    setPanStart(null);\n  }, []);\n\n  // Handle zoom with mouse wheel\n  const handleWheel = useCallback((e: React.WheelEvent) => {\n    e.preventDefault();\n    const delta = e.deltaY > 0 ? 0.9 : 1.1;\n    setScale((prev) => Math.max(0.5, Math.min(5, prev * delta)));\n  }, []);\n\n  // Handle keyboard shortcuts\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === \"Delete\" || e.key === \"Backspace\") {\n        if (selectedPosition) {\n          onPositionsChange(positions.filter((p) => p.id !== selectedPosition));\n          setSelectedPosition(null);\n        }\n      }\n      if (e.key === \"Escape\") {\n        setIsSelectingFileNamePosition(false);\n        setPendingFileNameLinkId(null);\n      }\n    };\n\n    window.addEventListener(\"keydown\", handleKeyDown);\n    return () => window.removeEventListener(\"keydown\", handleKeyDown);\n  }, [selectedPosition, positions, onPositionsChange]);\n\n  // Handle overlay image upload for selected position\n  const handleOverlayUpload = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file || !selectedPosition) return;\n\n    const reader = new FileReader();\n    reader.onloadend = () => {\n      const updatedPositions = positions.map((pos) =>\n        pos.id === selectedPosition\n          ? {\n              ...pos,\n              overlayImage: reader.result as string,\n              overlayFileName: file.name,\n            }\n          : pos\n      );\n      onPositionsChange(updatedPositions);\n    };\n    reader.readAsDataURL(file);\n\n    // Reset input\n    if (overlayInputRef.current) {\n      overlayInputRef.current.value = \"\";\n    }\n  };\n\n  // Remove overlay from selected position\n  const handleRemoveOverlay = () => {\n    if (!selectedPosition) return;\n    const updatedPositions = positions.map((pos) =>\n      pos.id === selectedPosition\n        ? {\n            ...pos,\n            overlayImage: null,\n            overlayFileName: null,\n          }\n        : pos\n    );\n    onPositionsChange(updatedPositions);\n  };\n\n  // Toggle filename display for selected position\n  const handleToggleFileName = () => {\n    if (!selectedPosition) return;\n    const position = positions.find((p) => p.id === selectedPosition);\n    if (!position) return;\n\n    if (position.showFileName) {\n      // Turn off - also clear the linked position\n      const updatedPositions = positions.map((pos) =>\n        pos.id === selectedPosition\n          ? { ...pos, showFileName: false, fileNamePositionId: null }\n          : pos\n      );\n      onPositionsChange(updatedPositions);\n    } else {\n      // Turn on - enter selection mode\n      setIsSelectingFileNamePosition(true);\n      setPendingFileNameLinkId(selectedPosition);\n    }\n  };\n\n  // Handle clicking on a position to link filename display\n  const handlePositionClick = (positionId: string) => {\n    if (isSelectingFileNamePosition && pendingFileNameLinkId) {\n      // Link the filename to this position\n      const updatedPositions = positions.map((pos) =>\n        pos.id === pendingFileNameLinkId\n          ? { ...pos, showFileName: true, fileNamePositionId: positionId }\n          : pos\n      );\n      onPositionsChange(updatedPositions);\n      setIsSelectingFileNamePosition(false);\n      setPendingFileNameLinkId(null);\n    } else {\n      setSelectedPosition(positionId);\n    }\n  };\n\n  // Get the selected position object\n  const selectedPositionObj = positions.find((p) => p.id === selectedPosition);\n\n  // Find positions that have filenames linked to them\n  const getLinkedFileName = (positionId: string): string | null => {\n    const linkingPosition = positions.find(\n      (p) =>\n        p.showFileName &&\n        p.fileNamePositionId === positionId &&\n        p.overlayFileName\n    );\n    return linkingPosition?.overlayFileName || null;\n  };\n\n  // Render position shapes\n  const renderPosition = (position: Position, isSelected: boolean) => {\n    const baseStyle: React.CSSProperties = {\n      left: `${position.x * scale}px`,\n      top: `${position.y * scale}px`,\n      width: `${position.width * scale}px`,\n      height: `${position.height * scale}px`,\n      transform: `translate(${panOffset.x}px, ${panOffset.y}px)`,\n    };\n\n    let shapeStyle: React.CSSProperties = {};\n    let shapeClass = \"position-shape\";\n    let clipPath = \"\";\n\n    if (position.shape === \"CIRCLE\") {\n      shapeStyle = {\n        ...baseStyle,\n        borderRadius: \"50%\",\n      };\n      shapeClass = `position-shape position-circle ${\n        isSelected ? \"selected\" : \"\"\n      }`;\n    } else if (position.shape === \"TRAPEZOID\") {\n      const topWidth = position.width * 0.8;\n      const topOffset = (position.width - topWidth) / 2;\n      const topLeftPercent = (topOffset / position.width) * 100;\n      const topRightPercent = ((topOffset + topWidth) / position.width) * 100;\n      clipPath = `polygon(${topLeftPercent}% 0%, ${topRightPercent}% 0%, 100% 100%, 0% 100%)`;\n      shapeStyle = {\n        ...baseStyle,\n        clipPath,\n      };\n      shapeClass = `position-shape position-trapezoid ${\n        isSelected ? \"selected\" : \"\"\n      }`;\n    } else {\n      shapeStyle = baseStyle;\n      shapeClass = `position-shape position-rectangle ${\n        isSelected ? \"selected\" : \"\"\n      }`;\n    }\n\n    // Check if selecting filename position\n    const isSelectingTarget =\n      isSelectingFileNamePosition && pendingFileNameLinkId !== position.id;\n    if (isSelectingTarget) {\n      shapeClass += \" selecting-target\";\n    }\n\n    // Check if this position has a linked filename to display\n    const linkedFileName = getLinkedFileName(position.id);\n\n    return (\n      <div\n        key={position.id}\n        className={shapeClass}\n        style={shapeStyle}\n        onClick={(e) => {\n          e.stopPropagation();\n          handlePositionClick(position.id);\n        }}\n      >\n        {/* Overlay image with transparency support */}\n        {position.overlayImage && (\n          <img\n            src={position.overlayImage}\n            alt=\"Overlay\"\n            className=\"overlay-image\"\n            style={{\n              width: \"100%\",\n              height: \"100%\",\n              objectFit: \"fill\",\n              borderRadius: position.shape === \"CIRCLE\" ? \"50%\" : \"0\",\n              clipPath: position.shape === \"TRAPEZOID\" ? clipPath : undefined,\n            }}\n          />\n        )}\n\n        {/* Display linked filename */}\n        {linkedFileName && (\n          <div className=\"filename-display\">{linkedFileName}</div>\n        )}\n\n        {/* Position label - show transformed Top-left and Bottom-right */}\n        {!position.overlayImage &&\n          !linkedFileName &&\n          (() => {\n            const tl = transformCoordinate(position.x, position.y);\n            const br = transformCoordinate(\n              position.x + position.width,\n              position.y + position.height\n            );\n            return (\n              <div className=\"position-label\">\n                <span>\n                  TL: ({Math.round(tl.x)}, {Math.round(tl.y)})\n                </span>\n                <span>\n                  BR: ({Math.round(br.x)}, {Math.round(br.y)})\n                </span>\n              </div>\n            );\n          })()}\n\n        {/* Show indicator if this position has an overlay */}\n        {position.overlayImage && isSelected && (\n          <div className=\"overlay-indicator\">ðŸ“·</div>\n        )}\n\n        {/* Show link indicator */}\n        {position.showFileName && position.fileNamePositionId && (\n          <div className=\"link-indicator\">ðŸ”—</div>\n        )}\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"image-annotation-container\">\n      <div className=\"toolbar\">\n        <div className=\"zoom-controls\">\n          <button onClick={() => setScale((s) => Math.max(0.5, s - 0.1))}>\n            Zoom Out\n          </button>\n          <span>{Math.round(scale * 100)}%</span>\n          <button onClick={() => setScale((s) => Math.min(5, s + 0.1))}>\n            Zoom In\n          </button>\n          <button onClick={() => setScale(1)}>Reset Zoom</button>\n        </div>\n        <div className=\"pan-controls\">\n          <button onClick={() => setPanOffset({ x: 0, y: 0 })}>\n            Reset Pan\n          </button>\n        </div>\n        <div className=\"shape-selector\">\n          <label>Shape: </label>\n          <select\n            value={selectedShape}\n            onChange={(e) => setSelectedShape(e.target.value as ShapeType)}\n          >\n            <option value=\"RECTANGLE\">Rectangle</option>\n            <option value=\"CIRCLE\">Circle</option>\n            <option value=\"TRAPEZOID\">Trapezoid</option>\n          </select>\n        </div>\n        <div className=\"origin-selector\">\n          <label>Coordinate Origin: </label>\n          <select\n            value={coordinateOrigin}\n            onChange={(e) =>\n              onCoordinateOriginChange(e.target.value as CoordinateOrigin)\n            }\n          >\n            <option value=\"TOP_LEFT\">Top-Left â†˜</option>\n            <option value=\"TOP_RIGHT\">Top-Right â†™</option>\n            <option value=\"BOTTOM_LEFT\">Bottom-Left â†—</option>\n            <option value=\"BOTTOM_RIGHT\">Bottom-Right â†–</option>\n            <option value=\"CENTER\">Center âœ›</option>\n          </select>\n        </div>\n        <div className=\"instructions\">\n          <p>\n            Click and drag to create shapes | Ctrl+Click to pan | Scroll to zoom\n            | Delete to remove selected\n          </p>\n        </div>\n      </div>\n\n      <div\n        ref={containerRef}\n        className=\"image-container\"\n        onMouseDown={handleMouseDown}\n        onMouseMove={handleMouseMove}\n        onMouseUp={handleMouseUp}\n        onMouseLeave={handleMouseUp}\n        onWheel={handleWheel}\n        onMouseDownCapture={handlePanStart}\n        onMouseMoveCapture={handlePanMove}\n        onMouseUpCapture={handlePanEnd}\n      >\n        <img\n          ref={imageRef}\n          src={imageUrl}\n          alt=\"Annotation target\"\n          className=\"annotation-image\"\n          style={{\n            transform: `scale(${scale}) translate(${panOffset.x / scale}px, ${\n              panOffset.y / scale\n            }px)`,\n            transformOrigin: \"top left\",\n          }}\n          draggable={false}\n        />\n\n        {/* Render existing positions */}\n        {positions.map((position) =>\n          renderPosition(position, position.id === selectedPosition)\n        )}\n\n        {/* Render current drawing shape */}\n        {isDrawing &&\n          currentRect &&\n          (() => {\n            const baseStyle = {\n              left: `${currentRect.x * scale}px`,\n              top: `${currentRect.y * scale}px`,\n              width: `${currentRect.width * scale}px`,\n              height: `${currentRect.height * scale}px`,\n              transform: `translate(${panOffset.x}px, ${panOffset.y}px)`,\n            };\n\n            if (currentRect.shape === \"CIRCLE\") {\n              return (\n                <div\n                  className=\"position-shape position-circle drawing\"\n                  style={{\n                    ...baseStyle,\n                    borderRadius: \"50%\",\n                  }}\n                />\n              );\n            } else if (currentRect.shape === \"TRAPEZOID\") {\n              const topWidth = currentRect.width * 0.8;\n              const topOffset = (currentRect.width - topWidth) / 2;\n              const topLeftPercent = (topOffset / currentRect.width) * 100;\n              const topRightPercent =\n                ((topOffset + topWidth) / currentRect.width) * 100;\n              return (\n                <div\n                  className=\"position-shape position-trapezoid drawing\"\n                  style={{\n                    ...baseStyle,\n                    clipPath: `polygon(${topLeftPercent}% 0%, ${topRightPercent}% 0%, 100% 100%, 0% 100%)`,\n                  }}\n                />\n              );\n            } else {\n              return (\n                <div\n                  className=\"position-shape position-rectangle drawing\"\n                  style={baseStyle}\n                />\n              );\n            }\n          })()}\n      </div>\n\n      {/* Selection mode indicator */}\n      {isSelectingFileNamePosition && (\n        <div className=\"selection-mode-banner\">\n          ðŸŽ¯ Click on a position where the filename should be displayed (ESC to\n          cancel)\n        </div>\n      )}\n\n      {/* Selected position controls */}\n      {selectedPositionObj && (\n        <div className=\"selected-position-controls\">\n          <h4>Selected Position Controls</h4>\n\n          <div className=\"control-group\">\n            <label>Overlay Image:</label>\n            <input\n              ref={overlayInputRef}\n              type=\"file\"\n              accept=\"image/*\"\n              onChange={handleOverlayUpload}\n              style={{ display: \"none\" }}\n              id=\"overlay-upload\"\n            />\n            <div className=\"control-buttons\">\n              <label\n                htmlFor=\"overlay-upload\"\n                className=\"control-btn upload-overlay-btn\"\n              >\n                {selectedPositionObj.overlayImage\n                  ? \"Change Image\"\n                  : \"Upload Image\"}\n              </label>\n              {selectedPositionObj.overlayImage && (\n                <button\n                  className=\"control-btn remove-overlay-btn\"\n                  onClick={handleRemoveOverlay}\n                >\n                  Remove Image\n                </button>\n              )}\n            </div>\n            {selectedPositionObj.overlayFileName && (\n              <span className=\"filename-info\">\n                ðŸ“Ž {selectedPositionObj.overlayFileName}\n              </span>\n            )}\n          </div>\n\n          <div className=\"control-group\">\n            <label>Show Filename in Another Position:</label>\n            <div className=\"control-buttons\">\n              <button\n                className={`control-btn ${\n                  selectedPositionObj.showFileName ? \"active\" : \"\"\n                }`}\n                onClick={handleToggleFileName}\n                disabled={!selectedPositionObj.overlayImage}\n              >\n                {selectedPositionObj.showFileName\n                  ? `Linked to Position`\n                  : \"Link Filename Display\"}\n              </button>\n              {selectedPositionObj.showFileName && (\n                <button\n                  className=\"control-btn remove-link-btn\"\n                  onClick={() => {\n                    const updatedPositions = positions.map((pos) =>\n                      pos.id === selectedPosition\n                        ? {\n                            ...pos,\n                            showFileName: false,\n                            fileNamePositionId: null,\n                          }\n                        : pos\n                    );\n                    onPositionsChange(updatedPositions);\n                  }}\n                >\n                  Remove Link\n                </button>\n              )}\n            </div>\n            {!selectedPositionObj.overlayImage && (\n              <span className=\"hint-text\">\n                Upload an image first to enable filename display\n              </span>\n            )}\n          </div>\n        </div>\n      )}\n\n      <div className=\"positions-list\">\n        <h3>Positions ({positions.length})</h3>\n        {positions.length === 0 ? (\n          <p className=\"empty-list\">No positions selected yet</p>\n        ) : (\n          <div className=\"positions-table\">\n            <table>\n              <thead>\n                <tr>\n                  <th>#</th>\n                  <th>Shape</th>\n                  <th>Coordinates</th>\n                  <th>Action</th>\n                </tr>\n              </thead>\n              <tbody>\n                {positions.map((pos, index) => {\n                  // Calculate corner points with transformed coordinates\n                  let cornerPoints: Array<{\n                    x: number;\n                    y: number;\n                    label: string;\n                  }> = [];\n\n                  if (pos.shape === \"RECTANGLE\") {\n                    const tl = transformCoordinate(pos.x, pos.y);\n                    const br = transformCoordinate(\n                      pos.x + pos.width,\n                      pos.y + pos.height\n                    );\n                    cornerPoints = [\n                      {\n                        x: Math.round(tl.x),\n                        y: Math.round(tl.y),\n                        label: \"Top-left\",\n                      },\n                      {\n                        x: Math.round(br.x),\n                        y: Math.round(br.y),\n                        label: \"Bottom-right\",\n                      },\n                    ];\n                  } else if (pos.shape === \"CIRCLE\") {\n                    const rawCenterX = pos.x + pos.width / 2;\n                    const rawCenterY = pos.y + pos.height / 2;\n                    const center = transformCoordinate(rawCenterX, rawCenterY);\n                    const radius = Math.round(\n                      Math.max(pos.width, pos.height) / 2\n                    );\n                    cornerPoints = [\n                      {\n                        x: Math.round(center.x),\n                        y: Math.round(center.y),\n                        label: \"Center\",\n                      },\n                      { x: radius, y: 0, label: \"Radius\" },\n                    ];\n                  } else if (pos.shape === \"TRAPEZOID\") {\n                    const topWidth = pos.width * 0.8;\n                    const topOffset = (pos.width - topWidth) / 2;\n                    const tl = transformCoordinate(pos.x + topOffset, pos.y);\n                    const br = transformCoordinate(\n                      pos.x + pos.width,\n                      pos.y + pos.height\n                    );\n                    cornerPoints = [\n                      {\n                        x: Math.round(tl.x),\n                        y: Math.round(tl.y),\n                        label: \"Top-left\",\n                      },\n                      {\n                        x: Math.round(br.x),\n                        y: Math.round(br.y),\n                        label: \"Bottom-right\",\n                      },\n                    ];\n                  }\n\n                  return (\n                    <tr\n                      key={pos.id}\n                      className={\n                        selectedPosition === pos.id ? \"selected-row\" : \"\"\n                      }\n                      onClick={() => setSelectedPosition(pos.id)}\n                    >\n                      <td>{index + 1}</td>\n                      <td>{pos.shape}</td>\n                      <td className=\"coordinates-cell\">\n                        {cornerPoints.map((pt, i) => (\n                          <span key={i} className=\"coordinate-point\">\n                            {pt.label}: ({pt.x}, {pt.y})\n                          </span>\n                        ))}\n                      </td>\n                      <td>\n                        <button\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            onPositionsChange(\n                              positions.filter((p) => p.id !== pos.id)\n                            );\n                          }}\n                          className=\"delete-btn\"\n                        >\n                          Delete\n                        </button>\n                      </td>\n                    </tr>\n                  );\n                })}\n              </tbody>\n            </table>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default ImageAnnotation;\n","import React, { useState, useRef } from \"react\";\nimport \"./components/App.css\";\nimport ImageAnnotation from \"./components/ImageAnnotation\";\nimport * as pdfjsLib from \"pdfjs-dist\";\n\n// Set the worker source for PDF.js\npdfjsLib.GlobalWorkerOptions.workerSrc = `//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjsLib.version}/pdf.worker.min.js`;\n\nexport type ShapeType = \"RECTANGLE\" | \"CIRCLE\" | \"TRAPEZOID\";\nexport type ImageFormat = \"PNG\" | \"JPEG\";\nexport type CoordinateOrigin = \"TOP_LEFT\" | \"TOP_RIGHT\" | \"BOTTOM_LEFT\" | \"BOTTOM_RIGHT\" | \"CENTER\";\n\nexport interface Position {\n  id: string;\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  shape: ShapeType;\n  // Overlay image properties\n  overlayImage?: string | null;\n  overlayFileName?: string | null;\n  showFileName?: boolean;\n  fileNamePositionId?: string | null; // ID of position where filename will be displayed\n}\n\nfunction App() {\n  const [imageUrl, setImageUrl] = useState<string | null>(null);\n  const [positions, setPositions] = useState<Position[]>([]);\n  const [imageDimensions, setImageDimensions] = useState<{ width: number; height: number } | null>(null);\n  const [showFormatModal, setShowFormatModal] = useState(false);\n  const [pendingPdfFile, setPendingPdfFile] = useState<File | null>(null);\n  const [isConverting, setIsConverting] = useState(false);\n  const [coordinateOrigin, setCoordinateOrigin] = useState<CoordinateOrigin>(\"TOP_LEFT\");\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const convertPdfToImage = async (file: File, format: ImageFormat): Promise<string> => {\n    const arrayBuffer = await file.arrayBuffer();\n    const uint8Array = new Uint8Array(arrayBuffer);\n    const pdf = await pdfjsLib.getDocument({ data: uint8Array }).promise;\n    const page = await pdf.getPage(1); // Get first page\n\n    // Get the original PDF page dimensions at scale 1\n    const viewport = page.getViewport({ scale: 1 });\n    \n    // Use higher scale for better quality while maintaining aspect ratio\n    const scale = 2; // 2x for better quality\n    const scaledViewport = page.getViewport({ scale });\n\n    // Create canvas with PDF dimensions\n    const canvas = document.createElement(\"canvas\");\n    canvas.width = scaledViewport.width;\n    canvas.height = scaledViewport.height;\n\n    const context = canvas.getContext(\"2d\");\n    if (!context) {\n      throw new Error(\"Could not get canvas context\");\n    }\n\n    // Render PDF page to canvas\n    await page.render({\n      canvasContext: context,\n      viewport: scaledViewport,\n    }).promise;\n\n    // Convert canvas to image data URL\n    const mimeType = format === \"PNG\" ? \"image/png\" : \"image/jpeg\";\n    const quality = format === \"JPEG\" ? 0.95 : undefined;\n    const dataUrl = canvas.toDataURL(mimeType, quality);\n\n    // Store original dimensions (before scale) for accurate position mapping\n    setImageDimensions({\n      width: viewport.width,\n      height: viewport.height,\n    });\n\n    console.log(`PDF converted to ${format}`);\n    console.log(`Original PDF dimensions: ${viewport.width} x ${viewport.height}`);\n    console.log(`Canvas dimensions: ${canvas.width} x ${canvas.height}`);\n\n    return dataUrl;\n  };\n\n  const handleFormatSelect = async (format: ImageFormat) => {\n    if (!pendingPdfFile) return;\n\n    setIsConverting(true);\n    setShowFormatModal(false);\n\n    try {\n      const imageDataUrl = await convertPdfToImage(pendingPdfFile, format);\n      setImageUrl(imageDataUrl);\n      setPositions([]);\n    } catch (error) {\n      console.error(\"Error converting PDF:\", error);\n      alert(\"Failed to convert PDF. Please try again.\");\n    } finally {\n      setIsConverting(false);\n      setPendingPdfFile(null);\n    }\n  };\n\n  const handleImageUpload = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file) return;\n\n    // Check if it's a PDF\n    if (file.type === \"application/pdf\") {\n      setPendingPdfFile(file);\n      setShowFormatModal(true);\n      return;\n    }\n\n    // Regular image upload\n    const reader = new FileReader();\n    reader.onloadend = () => {\n      const dataUrl = reader.result as string;\n      // Get image dimensions\n      const img = new Image();\n      img.onload = () => {\n        setImageDimensions({ width: img.naturalWidth, height: img.naturalHeight });\n        setImageUrl(dataUrl);\n        setPositions([]);\n      };\n      img.src = dataUrl;\n    };\n    reader.readAsDataURL(file);\n  };\n\n  // Transform coordinate based on selected origin\n  const transformCoordinate = (x: number, y: number): { x: number; y: number } => {\n    if (!imageDimensions) return { x, y };\n    \n    const { width: imgW, height: imgH } = imageDimensions;\n    \n    switch (coordinateOrigin) {\n      case \"TOP_LEFT\":\n        return { x, y };\n      case \"TOP_RIGHT\":\n        return { x: imgW - x, y };\n      case \"BOTTOM_LEFT\":\n        return { x, y: imgH - y };\n      case \"BOTTOM_RIGHT\":\n        return { x: imgW - x, y: imgH - y };\n      case \"CENTER\":\n        return { x: x - imgW / 2, y: y - imgH / 2 };\n      default:\n        return { x, y };\n    }\n  };\n\n  const handlePositionsChange = (newPositions: Position[]) => {\n    setPositions(newPositions);\n  };\n\n  const handleSavePositions = () => {\n    if (positions.length === 0) {\n      alert(\"No positions to save\");\n      return;\n    }\n\n    // Format coordinates in database format with selected origin transformation\n    const databaseFormat = positions.map((pos) => {\n      let coordinates: Array<{ x: number; y: number }> = [];\n\n      if (pos.shape === \"RECTANGLE\") {\n        // For rectangle: Top-left and Bottom-right (transformed)\n        const tl = transformCoordinate(pos.x, pos.y);\n        const br = transformCoordinate(pos.x + pos.width, pos.y + pos.height);\n        coordinates = [\n          { x: Math.round(tl.x), y: Math.round(tl.y) },\n          { x: Math.round(br.x), y: Math.round(br.y) },\n        ];\n      } else if (pos.shape === \"CIRCLE\") {\n        // For circle: center point (transformed) and radius\n        const rawCenterX = pos.x + pos.width / 2;\n        const rawCenterY = pos.y + pos.height / 2;\n        const center = transformCoordinate(rawCenterX, rawCenterY);\n        const radius = Math.round(Math.max(pos.width, pos.height) / 2);\n        coordinates = [\n          { x: Math.round(center.x), y: Math.round(center.y) },\n          { x: radius, y: 0 }, // Radius as separate value\n        ];\n      } else if (pos.shape === \"TRAPEZOID\") {\n        // For trapezoid: Top-left and Bottom-right (transformed)\n        const topWidth = pos.width * 0.8;\n        const topOffset = (pos.width - topWidth) / 2;\n        const tl = transformCoordinate(pos.x + topOffset, pos.y);\n        const br = transformCoordinate(pos.x + pos.width, pos.y + pos.height);\n        coordinates = [\n          { x: Math.round(tl.x), y: Math.round(tl.y) },\n          { x: Math.round(br.x), y: Math.round(br.y) },\n        ];\n      }\n\n      return {\n        coordinates: JSON.stringify(coordinates),\n        shape: pos.shape,\n      };\n    });\n\n    // Create a formatted string to display\n    const formattedData = JSON.stringify(databaseFormat, null, 2);\n\n    // Display in console\n    console.log(\"=== SAVE POSITIONS ===\");\n    console.log(\"Coordinate Origin:\", coordinateOrigin);\n    console.log(\"Image Dimensions:\", imageDimensions);\n    console.log(\"Database Format (Coordinates | Shape):\");\n    databaseFormat.forEach((item, index) => {\n      console.log(\n        `${index + 1}. Coordinates: ${item.coordinates} | Shape: ${item.shape}`\n      );\n    });\n    console.log(\"\\nFull JSON:\", formattedData);\n    console.log(\"======================\");\n\n    // Display in alert (formatted nicely)\n    const alertMessage = `Database Format:\\n\\n${databaseFormat\n      .map(\n        (item, index) =>\n          `Position ${index + 1}:\\n  Coordinates: ${\n            item.coordinates\n          }\\n  Shape: ${item.shape}`\n      )\n      .join(\"\\n\\n\")}\\n\\n\\n(Also check console for full details)`;\n\n    alert(alertMessage);\n  };\n\n  const handleReset = () => {\n    setImageUrl(null);\n    setPositions([]);\n    setImageDimensions(null);\n    setPendingPdfFile(null);\n    setShowFormatModal(false);\n    if (fileInputRef.current) {\n      fileInputRef.current.value = \"\";\n    }\n  };\n\n  const handleCancelFormatModal = () => {\n    setShowFormatModal(false);\n    setPendingPdfFile(null);\n    if (fileInputRef.current) {\n      fileInputRef.current.value = \"\";\n    }\n  };\n\n  return (\n    <div className=\"app\">\n      <div className=\"app-header\">\n        <h1>Advertisement Position Selector</h1>\n        <div className=\"app-controls\">\n          {!imageUrl ? (\n            <>\n              <input\n                ref={fileInputRef}\n                type=\"file\"\n                accept=\"image/*,.pdf\"\n                onChange={handleImageUpload}\n                style={{ display: \"none\" }}\n                id=\"image-upload\"\n                disabled={isConverting}\n              />\n              <label htmlFor=\"image-upload\" className={`upload-button ${isConverting ? 'disabled' : ''}`}>\n                {isConverting ? \"Converting PDF...\" : \"Upload Image/PDF\"}\n              </label>\n            </>\n          ) : (\n            <>\n              <button onClick={handleReset} className=\"reset-button\">\n                Upload New Image\n              </button>\n              <button\n                onClick={handleSavePositions}\n                className=\"save-button\"\n                disabled={positions.length === 0}\n              >\n                Save Positions ({positions.length})\n              </button>\n            </>\n          )}\n        </div>\n      </div>\n\n      {imageUrl ? (\n        <ImageAnnotation\n          imageUrl={imageUrl}\n          positions={positions}\n          onPositionsChange={handlePositionsChange}\n          coordinateOrigin={coordinateOrigin}\n          onCoordinateOriginChange={setCoordinateOrigin}\n        />\n      ) : (\n        <div className=\"empty-state\">\n          <p>Upload an image or PDF to start selecting advertisement positions</p>\n          {isConverting && <p className=\"converting-text\">Converting PDF, please wait...</p>}\n        </div>\n      )}\n\n      {/* Format Selection Modal for PDF */}\n      {showFormatModal && (\n        <div className=\"modal-overlay\">\n          <div className=\"modal\">\n            <h2>Select Output Format</h2>\n            <p>Choose the image format for the PDF conversion:</p>\n            <p className=\"modal-note\">Dimensions will be preserved for accurate position mapping.</p>\n            <div className=\"modal-buttons\">\n              <button\n                className=\"format-button png-button\"\n                onClick={() => handleFormatSelect(\"PNG\")}\n              >\n                PNG\n                <span className=\"format-desc\">Lossless, larger file</span>\n              </button>\n              <button\n                className=\"format-button jpeg-button\"\n                onClick={() => handleFormatSelect(\"JPEG\")}\n              >\n                JPEG\n                <span className=\"format-desc\">Compressed, smaller file</span>\n              </button>\n            </div>\n            <button className=\"cancel-button\" onClick={handleCancelFormatModal}>\n              Cancel\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Show dimensions if available */}\n      {imageDimensions && (\n        <div className=\"dimensions-info\">\n          Original PDF Size: {Math.round(imageDimensions.width)} x {Math.round(imageDimensions.height)} px\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}